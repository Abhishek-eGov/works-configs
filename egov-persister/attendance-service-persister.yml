serviceMaps:
 serviceName: attendance-service
 mappings:
 - version: 1.0
   name: attendance
   description: Persists attendance details in eg_wms_attendance_register table
   fromTopic: save-attendance
   isTransaction: true
   queryMaps:
    - query: INSERT INTO eg_wms_attendance_register(id,tenantid,registernumber,name,startdate,enddate,status,additionaldetails,createdby,lastmodifiedby,createdtime,lastmodifiedtime) VALUES (?,?,?,?,?,?,?,?,?,?,?,?);

      basePath: attendanceRegister
      jsonMaps:


       - jsonPath: $.attendanceRegister.id

       - jsonPath: $.attendanceRegister.tenantId

       - jsonPath: $.attendanceRegister.registerNumber

       - jsonPath: $.attendanceRegister.name

       - jsonPath: $.attendanceRegister.startDate

       - jsonPath: $.attendanceRegister.endDate

       - jsonPath: $.attendanceRegister.status

       - jsonPath: $.attendanceRegister.additionalDetails
         type: JSON
         dbType: JSONB

       - jsonPath: $.attendanceRegister.auditDetails.createdBy

       - jsonPath: $.attendanceRegister.auditDetails.lastModifiedBy

       - jsonPath: $.attendanceRegister.auditDetails.createdTime

       - jsonPath: $.attendanceRegister.auditDetails.lastModifiedTime


    - query: INSERT INTO eg_wms_attendance_attendee(id,tenantid,individual_id,register_id,enrollment_date,deenrollment_date,attendee_type,permission_type,additionaldetails,createdby,lastmodifiedby,createdtime,lastmodifiedtime) VALUES (?,?,?,?,?,?,?,?,?,?,?,?,?);

      basePath: attendanceRegister.attendees.*
      jsonMaps:

       - jsonPath: $.attendanceRegister.attendees.*.id

       - jsonPath: $.attendanceRegister.tenantId

       - jsonPath: $.attendanceRegister.attendees.*.individualId

       - jsonPath: $.attendanceRegister.attendees.*.registerId

       - jsonPath: $.attendanceRegister.attendees.*.enrollmentDate

       - jsonPath: $.attendanceRegister.attendees.*.denrollmentDate

       - jsonPath: $.attendanceRegister.attendees.*.id

       - jsonPath: $.attendanceRegister.staff.*.id

       - jsonPath: $.attendanceRegister.attendees.*.additionalDetails
         type: JSON
         dbType: JSONB

       - jsonPath: $.attendanceRegister.attendees.*.auditDetails.createdBy

       - jsonPath: $.attendanceRegister.attendees.*.auditDetails.lastModifiedBy

       - jsonPath: $.attendanceRegister.attendees.*.auditDetails.createdTime

       - jsonPath: $.attendanceRegister.attendees.*.auditDetails.lastModifiedTime
   
    
    - query: INSERT INTO eg_wms_attendance_log(id,tenantid,individual_id,register_id,status,time,event_type,additionaldetails,createdby,lastmodifiedby,createdtime,lastmodifiedtime) VALUES (?,?,?,?,?,?,?,?,?,?,?,?,?);

      basePath: attendance.*
      jsonMaps:


       - jsonPath: $.attendance.*.id

       - jsonPath: $.attendance.*.tenantId

       - jsonPath: $.attendance.*.individualId

       - jsonPath: $.attendance.*.registerId

       - jsonPath: $.attendance.*.status

       - jsonPath: $.attendance.*.time

       - jsonPath: $.attendance.*.type

       - jsonPath: $.attendance.*.additionalDetails
         type: JSON
         dbType: JSONB

       - jsonPath: $.attendance.*.auditDetails.createdBy

       - jsonPath: $.attendance.*.auditDetails.lastModifiedBy

       - jsonPath: $.attendance.*.auditDetails.createdTime

       - jsonPath: $.attendance.*.auditDetails.lastModifiedTime

    - query: INSERT INTO eg_wms_attendance_document(id,tenantid,filestore_id,document_type,attendance_log_id,additionaldetails,createdby,lastmodifiedby,createdtime,lastmodifiedtime) VALUES (?,?,?,?,?,?,?,?,?,?,?,?,?);

      basePath: attendance.*.documentIds
      jsonMaps:


       - jsonPath: $.attendance.*.documentIds.*.id

       - jsonPath: $.attendance.*.tenantId

       - jsonPath: $.attendance.*.documentIds.*.fileStore

       - jsonPath: $.attendance.*.documentIds.*.documentType

       - jsonPath: $.attendance.*.id

       - jsonPath: $.attendance.*.documentIds.*.additionalDetails
         type: JSON
         dbType: JSONB

       - jsonPath: $.attendance.*.auditDetails.createdBy

       - jsonPath: $.attendance.*.auditDetails.lastModifiedBy

       - jsonPath: $.attendance.*.auditDetails.createdTime

       - jsonPath: $.attendance.*.auditDetails.lastModifiedTime 
   
 - version: 1.0
   description: Save  Attendance
   fromTopic: save-attendance
   isTransaction: true
   queryMaps:
      - query: UPDATE eg_wms_attendance_register set name=?, startdate=?, enddate=?, status=?,additionaldetails=?,lastmodifiedby=?, lastmodifiedtime=? where id=?;
        basePath: attendanceRegister
        jsonMaps:           

          - jsonPath: $.attendanceRegister.name

          - jsonPath: $.attendanceRegister.startDate

          - jsonPath: $.attendanceRegister.endDate

          - jsonPath: $.attendanceRegister.status

          - jsonPath: $.attendanceRegister.additionalDetails
            type: JSON
            dbType: JSONB

          - jsonPath: $.attendanceRegister.auditDetails.createdTime

          - jsonPath: $.attendanceRegister.auditDetails.lastModifiedTime
          
          - jsonPath: $.attendanceRegister.id
          
          
      - query: UPDATE eg_wms_attendance_attendee set individual_id=?, register_id=?, enrollment_date=?, deenrollment_date=?,attendee_type=?,permission_type=?,additionaldetails=?,lastmodifiedby=?, lastmodifiedtime=? where id=?;
        basePath: attendanceRegister.attendees.*
        jsonMaps:   

         - jsonPath: $.attendanceRegister.attendees.*.individualId

         - jsonPath: $.attendanceRegister.attendees.*.registerId

         - jsonPath: $.attendanceRegister.attendees.*.enrollmentDate

         - jsonPath: $.attendanceRegister.attendees.*.denrollmentDate

         - jsonPath: $.attendanceRegister.attendees.*.id

         - jsonPath: $.attendanceRegister.staff.*.id

         - jsonPath: $.attendanceRegister.attendees.*.additionalDetails
           type: JSON
           dbType: JSONB

         - jsonPath: $.attendanceRegister.attendees.*.auditDetails.lastModifiedBy
 
         - jsonPath: $.attendanceRegister.attendees.*.auditDetails.lastModifiedTime

         - jsonPath: $.attendanceRegister.attendees.*.id

      
      - query: UPDATE eg_wms_attendance_log set individual_id=?, register_id=?, status=?, time=?,event_type=?,additionaldetails=?,lastmodifiedby=?, lastmodifiedtime=? where id=?;
        basePath: attendance.*
        jsonMaps:


        - jsonPath: $.attendance.*.individualId

        - jsonPath: $.attendance.*.registerId

        - jsonPath: $.attendance.*.status

        - jsonPath: $.attendance.*.time

        - jsonPath: $.attendance.*.type

        - jsonPath: $.attendance.*.additionalDetails
          type: JSON
          dbType: JSONB

        - jsonPath: $.attendance.*.auditDetails.lastModifiedBy

        - jsonPath: $.attendance.*.auditDetails.lastModifiedTime

        - jsonPath: $.attendance.*.id

      - query: UPDATE eg_wms_attendance_document set filestore_id=?, document_type=?, attendance_log_id=?, time=?,event_type=?,additionaldetails=?,lastmodifiedby=?, lastmodifiedtime=? where id=?;
       
        basePath: attendance.*.documentIds
        jsonMaps:

          - jsonPath: $.attendance.*.documentIds.*.fileStore

          - jsonPath: $.attendance.*.documentIds.*.documentType

          - jsonPath: $.attendance.*.id

          - jsonPath: $.attendance.*.documentIds.*.additionalDetails
            type: JSON
            dbType: JSONB

          - jsonPath: $.attendance.*.auditDetails.lastModifiedBy

          - jsonPath: $.attendance.*.auditDetails.lastModifiedTime  

          - jsonPath: $.attendance.*.documentIds.*.id